<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8"/>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Chatroom</title>
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
   <script src="/socket.io/socket.io.js"></script>
   <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/start/jquery-ui.css" type="text/css" rel="Stylesheet" /> <!-- jquery stylesheet -->
   <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script><!-- The main library. -->
   <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script><!-- jquery UI library; must be listed after the main lib -->

   <style type="text/css">
   body{
      background-color: black;
      margin: 0;
      padding: 0;
      font:12px/16px Verdana, sans-serif; /* default font */
   }
   h2{
      text-align: left;
      text-transform: bold;
      padding-left: 20px;
      padding-bottom: 20px;
      padding-top: 20px;
      background-color: black;
      color: white;
      margin-bottom: 50px;
   }
   div#main{
      background-color: #FFF;
      margin: 0;
      padding-bottom: 30px
   }

   h3 {
      color: #5D6D7E;
   }

   .msg_block{
      padding-left: 15px
   }

   .user_block{
      float: right;
      /*float:left*/
      padding-right: 15px;
      text-align: right;
      color: #5D6D7E
   }

   /* the following CSS is generated by the W3C tutorial on tabs */
   /* Style the list */
   ul.tab {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
   }

   /* Float the list items side by side */
   ul.tab li {float: left;}

   /* Style the links inside the list items */
   ul.tab li a {
     display: inline-block;
     color: black;
     text-align: center;
     padding: 14px 16px;
     text-decoration: none;
     transition: 0.3s;
     font-size: 17px;
  }

  /* Change background color of links on hover */
  ul.tab li a:hover {background-color: #ddd;}

  /* Create an active/current tablink class */
  ul.tab li a:focus, .active {
   background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
   display: none;
   padding: 6px 12px;
   border: 1px solid #ccc;
   border-top: none;
}
   /*
   #mainchat{
      display:inherit;
   }
   */
   div.scroll {
      background-color: white;
      margin-top: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      width: 100%;
      height: 400px;
      overflow: auto;
   }

   .tabspans {
      color: gray;
      texr-shadow: 1px 1px #aaa;
      visibility: hidden
   }

   .leave_rm_btn {
      float: right;
   }
/*   .chatroom {
      width: 70%;
      }*/

      #createChatDialog {display:none;}
      #createPrivatePassword{visibility: hidden}
      #chatusers{visibility: hidden;}
      #chatbans{visibility: hidden;}

      </style>

      <script type="text/javascript">

      function showCreateChatDialog(){
         $("#createChatDialog").dialog();
      }
      function closeCreateChatDialog(){
         $("#createChatDialog").dialog("close");
         $("#newchat").val("");
         $("#createPrivatePassword").val("");
         $("#radio-private").attr("checked", false);
         document.getElementById("createPrivatePassword").style.visibility = "hidden";
      }
      function closePwdSubmitDialog(){
         $("#unlockDialog").dialog("close");
         $("#pwdField").val("");
      }
      </script>

      <script type ="text/javascript">
      var msgCount = 0;
      var room_count = 0;
      var userAlias = "anonymous";
      var rooms = [];
      var socketio = io.connect();
      var currentRoomId = -1;
// function addUserMessage(message, user){}

function socketListeners(){
   socketio.on("send_all_rooms_to_client", function(data){
      for (var i = 0; i < data.length; i++){
         if (data[i].roomId == room_count){
            rooms[data[i].roomId] = new Room(data[i].name, data[i].owner, data[i].checkPrivate, data[i].password);
            console.log(rooms[data[i].roomId].name);
         }
      }
   });

   socketio.on("new_room_to_client", function(data){
      // console.log("---" + data);
      console.log("socket heard new room to client, owner: " + data["room"].user);
      rooms[room_count] = new Room(data["room"].name, data["room"].owner, data["room"].checkPrivate, data["room"].password);
      // createChatroomTab(data["room"].roomId, data["room"].name, data["room"].checkPrivate);
      // createChatroomBlockCheckPrivate(data["room"].roomId, data["room"].name, data["room"].checkPrivate);
   });

   socketio.on("ban_to_client", function(data){
      // console.log("ban to client ");
      // console.log(data);

      rooms[data["roomId"]].removeUser(data["user"]);
      rooms[data["roomId"]].banlist.push(data["user"]);
      var roomUsers = data["remainingUsers"];
      var bannedUsers = data["banlist"];
      var originalRoomUsers = rooms[data["roomId"]].users;
      // console.log("roomUsers: " + roomUsers);
      
      originalRoomUsers.splice(0, originalRoomUsers.length);
      for (var i = 0; i < roomUsers.length; i++){
         rooms[data["roomId"]].users[i] = roomUsers[i];
      }

      if (userAlias == data["user"]){
         // $(data["roomId"]+"_room_link").remove();
         document.getElementById(data["roomId"]+"_room_link").style.display="none";
         // $(data["roomId"]+"_room_link").parent().remove();
         $("ul.list-group li.active").removeClass("active");
         $(data["roomId"]).remove();
         document.getElementById("0_room_btn").click();
         document.getElementById("chatinfo").visibility="hidden";
         openChat(0);

         alert("You have been banned from " + rooms[data["roomId"]].name);
      }     
      showRoomUsers(data["roomId"]);
      showBannedUsers(data["roomId"]);
   });

socketio.on("unban_user_to_client", function(data){
   rooms[data["roomId"]].banlist.splice(rooms[data["roomId"]].banlist.indexOf(data["user"]), 1);
   console.log("unban to client");
   console.log(data);
   var roomBanlist = data["newBanlist"];
   var originalBanlist = rooms[data["roomId"]].banlist;

   originalBanlist.splice(0, originalBanlist.length);
   for (var i = 0; i < roomBanlist.length; i++){
      rooms[data["roomId"]].banlist[i] = roomBanlist[i];
   }
   showRoomUsers(data["roomId"]);
   // console.log("comparing clientuser: " + userAlias + " with server user: " + data["user"]);
   showBannedUsers(data["roomId"]);
      if (userAlias == data["user"]){
         alert("Your ban from " + rooms[data["roomId"]].name + " is lifted!");
      }     
});

socketio.on("kick_to_client", function(data){
   rooms[data["roomId"]].removeUser(data["user"]);
   // console.log(data);
   var roomUsers = data["remainingUsers"];
   var originalRoomUsers = rooms[data["roomId"]].users;
   // console.log("roomUsers: " + roomUsers);

   originalRoomUsers.splice(0, originalRoomUsers.length);
   for (var i = 0; i < roomUsers.length; i++){
      rooms[data["roomId"]].users[i] = roomUsers[i];
   }
   showRoomUsers(data["roomId"]);
   if (userAlias == data["user"]){
         // $(data["roomId"]+"_room_link").remove();
         document.getElementById(data["roomId"]+"_room_link").style.display="none";
         // $(data["roomId"]+"_room_link").parent().remove();
         $("ul.list-group li.active").removeClass("active");
         $(data["roomId"]).remove();
         document.getElementById("0_room_btn").click();
         document.getElementById("chatinfo").visibility="hidden";
         openChat(0);

         alert("You have been kicked out from " + rooms[data["roomId"]].name);
      }
   });

socketio.on("user_leave_to_client", function(data){
   rooms[data["roomId"]].removeUser(data["user"]);
   console.log(data);
   var roomUsers = data["remainingUsers"];
   var originalRoomUsers = rooms[data["roomId"]].users;
   console.log("leaving room users: ");
   console.log(roomUsers);

   originalRoomUsers.splice(0, originalRoomUsers.length);
   for (var i = 0; i < roomUsers.length; i++){
      rooms[data["roomId"]].users[i] = roomUsers[i];
      console.log("   copied "+ rooms[data["roomId"]].users[i]);
   }
   showRoomUsers(data["roomId"]);
   console.log("comparing clientuser: " + userAlias + " with server user: " + data["user"]);
   console.log()
   if (userAlias == data["user"]){
         // $(data["roomId"]+"_room_link").remove();
         console.log("user " + data["user"] + " leaving room: " + data["roomId"]);
         document.getElementById(data["roomId"]+"_room_link").style.display="none";
         // $(data["roomId"]+"_room_link").parent().remove();
         $("ul.list-group li.active").removeClass("active");
         $(data["roomId"]).remove();
         document.getElementById("0_room_btn").click();
         document.getElementById("chatinfo").visibility="hidden";
         openChat(0);
         if(rooms[data["roomId"]].name == "Main"){
            alert("Don't leave main!");
         } else {
            alert("You have left " + rooms[data["roomId"]].name);
         }
      }
   });


socketio.on("message_to_client",function(data){
      // addUserMessage(data["message"], data["user"]);
      //Append an HR thematic break and the escaped HTML of the new message
      var msgRoom = data["roomId"];
      console.log("room id: " + msgRoom);
      var tempchatlog = document.getElementById(msgRoom+"_chatlog");
      if (tempchatlog != null){
      document.getElementById(msgRoom+"_chatlog").appendChild(document.createElement("hr"));
      // set div for whole message from user
      var usermsg = document.createElement("div");
      //console.log(usermsg);
      usermsg.setAttribute("id", data['user']+"-"+msgCount);
      msgCount++;
      // set sub divs of message and useralias and append textnodes
      var msgBlock = document.createElement("div");
      msgBlock.setAttribute("class", "msg_block");
      var userBlock = document.createElement("div");
      userBlock.setAttribute("class", "user_block");

      msgBlock.appendChild(document.createTextNode(data["message"]));
      userBlock.appendChild(document.createTextNode(data["user"]));

      // append sub divs to main div
      usermsg.appendChild(userBlock);
      usermsg.appendChild(msgBlock);


      // append whole user message to chatlog
      document.getElementById(msgRoom+"_chatlog").appendChild(usermsg);
      }
   });

socketio.on("new_user_to_client", function(data){
      // console.log("adding user: " + data["user"] + " to room: " + data["roomId"]);
      // rooms[data["roomId"]].addUser(data["user"]);
      console.log(data);
      var roomUsers = data["users"];
      console.log("roomUsers: " + roomUsers);
      for (var i = 0; i < roomUsers.length; i++){
         rooms[data["roomId"]].users[i] = roomUsers[i];
      }
      showRoomUsers(data["roomId"]);
   });

}

function sendMessage(id){
   var msg = document.getElementById(id+"_message_input").value;
   if(msg!=""){
      // console.log("new room name: " + id);
      socketio.emit("message_to_server", {roomId: id, user: userAlias, message: msg});
      document.getElementById(id+"_message_input").value="";
   } else {
      alert("message can't be empty");
   }
}

function setAlias(){
   var temp = document.getElementById("alias").value;
   if (temp != ""){
      // console.log("heard user alias: " + temp);
      userAlias = temp;
      alert("set alias: " + userAlias);
      document.getElementById("alias").disabled = true;
      document.getElementById("aliasbtn").style.color = "gray";
      document.getElementById("aliasbtn").disabled = true;
   }
}

// this function is from StackOverflow
function setAttributes(el, attrs) {
   for(var key in attrs) {
    el.setAttribute(key, attrs[key]);
 }
}

</script>


</head>
<body>
   <div id="main" class="container-fluid">
      <div class="row">
         <h2>QuickChat</h2>
         <div class="col-sm-3" id="userinfo">
            <input type="text" id="alias" placeholder="Set Alias" />
            <button id="aliasbtn" onclick="setAlias()">Set Alias</button><br><br>

            <button id="createChat" onclick="showCreateChatDialog()"> New Chatroom </button>
            <br><br>
            <div id="currentRooms">
               <h5>Available Rooms</h5>
               <ul class="list-group" id="currentRoomsList">
                  <!-- <li class="list-group-item">Main Chat</li> -->
               </ul>
            </div>

            <!-- Create New Chat Dialog -->
            <div id="createChatDialog" title="New Chatroom">
               <input type="text" id="newchat" placeholder="New Chatroom Name" /><br>

               <input type="radio" name="choosePrivate" value="private" id="radio-private">Private<br>
               <input type="password" id="createPrivatePassword" placeholder="password"><br>
               <button id="createChatSubmit">Create</button>
            </div>
         </div>

         <div id="chattabs" class="col-sm-9">


            <ul id="tab-list" class="tab">
               <!--                <li><a href="javascript:void(0)" class="tablinks active" onclick="openChat(event, 0)" id="defaultOpen">MainChat</a></li> -->
            </ul>

            <div id="chat-content" class="row">
               <div id="chatarea" class="col-xs-8">

               </div>
               <div id="chatinfo" class="col-xs-4">
                  <div id="chatusers">
                     <h5 class="chatinfolists">Users</h5>
                     
                     <ul id="userlist" class="list-group"></ul>
                     <hr>
                  </div>
                  <div id="chatbans">
                     <h5 class="chatinfolists">Ban List (click to unban)</h5>
                     
                     <ul id="banUserList" class="list-group"></ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <script type="text/javascript">
   function makeRoomBtn(name, id){ // add btn for new room
      console.log("making rm btn: " + name + ", " + id);
      var roomBtn = document.createElement("button");
      setAttributes(roomBtn, {
         "class": "list-group-item",
         "value": name,
         "id": id+"_room_btn"
      });
      roomBtn.appendChild(document.createTextNode(name));
      console.log("roomName: " + name);
      var temp1 = document.getElementById(id+"_room_link");
      // if (name == "private_message"){
      //   if (rooms[id].users.indexOf(userAlias) >=0){
      //     document.getElementById("currentRoomsList").appendChild(roomBtn);
      //   }
      // }
      // else{
      document.getElementById("currentRoomsList").appendChild(roomBtn);
      //}
      document.getElementById(id+"_room_btn").addEventListener("click", function(){
         var temp = document.getElementById(id+"_room_link");
         if (temp!=null && temp.style.display!="none") {
            console.log("chat already in display");
            return;
         }

         if (rooms[id].name.indexOf("private message") >= 0 && rooms[id].users.indexOf(userAlias)<0){
          console.log("It is a private chat");
          //console.log("user_name"+rooms[id].users[0]);
          alert("It is a private chat");

          return;
         } else if (rooms[id].name.indexOf("private message") >= 0){
            
            createChatroomTab(id, rooms[id].name, rooms[id].checkPrivate);
            createChatroomBlockCheckPrivate(id, rooms[id].name, rooms[id].checkPrivate);

            openChat(id);
         }


         else if (rooms[id].checkPrivate && rooms[id].banlist.indexOf(userAlias)>=0){
            alert("Your are banned from this chatroom");
         } 
         else {
            var userExist = false;
            for (var i = 0; i < rooms[id].users.length; i++){
               console.log("matching existing user  " + rooms[id].users[i] + " with self " + userAlias);
               if (rooms[id].users[i] == userAlias){
                  userExist = true;
               }
            }
            if (userExist){return;}
            else {
               console.log("user is new, adding...");
               rooms[id].addUser(userAlias);
               socketio.emit("new_user_to_server", {
                  user:userAlias,
                  roomId:id
               });
            }
            createChatroomTab(id, rooms[id].name, rooms[id].checkPrivate);
            createChatroomBlockCheckPrivate(id, rooms[id].name, rooms[id].checkPrivate);

            openChat(id);
         }

      }, false);
}

function Room(name, owner, isPrivate, password) {
   // console.log("inside constructor: " + name + ", " + room_count);
   for (var i = 0; i < rooms.length; i++){
         if (rooms[i].name == name){ // no duplicate names allowed
            console.log("room name exists");
            return rooms[i];
         }
      }
      this.name = name
      this.owner = owner;
      this.checkPrivate = isPrivate;
      this.password = password;
      this.users = [];
      this.banlist = [];
      this.id = room_count;

      room_count++;

      this.addUser = function(newUser){
         this.users.push(newUser);
         // console.log(newUser + " is added to the current room");
      };
      this.removeUser = function(rmUser){
         if (this.users.indexOf(rmUser) > -1){
            this.users.splice(this.users.indexOf(rmUser),1);
            console.log(rmUser + " is removed from the current room");
         }
      }
      makeRoomBtn(this.name, this.id);

   }

   function openChat(id) {
      
      console.log("opening room " + id + ", current room: " + currentRoomId);
      var i, tabcontent, tablinks;
      if(currentRoomId == id){
         console.log("chat is already open");
      } else{
         currentRoomId = id;
         $("ul.list-group li.active").removeClass("active");

         tabcontent = document.getElementsByClassName("tabcontent");
         for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            // console.log("hiding " + tabcontent[i].id);
         }

         tablinks = document.getElementsByClassName("tablinks");
         for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
            // console.log("deactivating " + tablinks[i].id);

         }

         // console.log("display " + id);
         document.getElementById(id).style.display = "block";

         $("#"+id+"_room_link").addClass("active");
         $("#banUserlist").empty();
         $("#chatbans").hide();
         showRoomUsers(id);
      }
   }

   // the following code for the tabs feature is inspired by the W3C tutorial
   // http://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_tabs_open
   function createChatroom(){
      var newRoomName = document.getElementById("newchat").value;
      var isPrivate = document.getElementById("radio-private").checked;
      for (room in rooms){
         if (room.name == newRoomName){
            alert("Room with the same name exists");
            return;
         }
      }
      if (newRoomName != ""){

         if(isPrivate){ 
            // room is private. Need: password, owner, user list, banned list
            // console.log("creating room: " + newRoomName + " - private? " + isPrivate);
            var pwd = document.getElementById("createPrivatePassword").value;
            if(pwd == ""){
               alert("private room must have a password");
            } else{
               socketio.emit("new_room_to_server", {room: newRoomName, user: userAlias, isPrivate:true, password:pwd});
            }

         } else { 
            // room is public. Need: owner, user list
            // console.log("creating room: " + newRoomName + "not private");
            socketio.emit("new_room_to_server", {room: newRoomName, user: userAlias, isPrivate:false, password:""});
         }

      }
   }

   function createChatroomTab(id, newRoomName, isPrivate){

      var newRoom = document.createElement("li");
      var newRoomLink = document.createElement("a");
      setAttributes(newRoomLink, {
         "href": "javascript:void(0)",
         "class": "tablinks",
         "id": id+"_room_link"
      });
      newRoomLink.appendChild(document.createTextNode(newRoomName));

      newRoom.appendChild(newRoomLink);
      // console.log(id+"_room_link");
      document.getElementById("tab-list").appendChild(newRoom);
      document.getElementById(id+"_room_link").addEventListener("click", function(){openChat(id);}, false);

   }
   

   function createChatroomBlockCheckPrivate(id, newRoomName, isPrivate){
      var newChatDiv = document.createElement("div");
      setAttributes(newChatDiv, {
         "id": id,
         "class": "tabcontent chatroom"
      });
      document.getElementById("chatarea").appendChild(newChatDiv);

      if (isPrivate){

         var promptPassword = prompt("Enter password");
         while(promptPassword == null){
            promptPassword = prompt("Enter password");
         }
         if (promptPassword == rooms[id].password){
            // createChatroomBlock(id, newRoomName, true);

            var newChatInput = document.createElement("input");
            setAttributes(newChatInput, {
               "type": "text",
               "id": id+"_message_input"
            }); 
            var newChatButton = document.createElement("button");
            setAttributes(newChatButton, {
               "id": id+"_send_btn"
            });
            newChatButton.appendChild(document.createTextNode("send"));
            var leaveRoomBtn = document.createElement("button");
            setAttributes(leaveRoomBtn, {
               "id": id+"_leave_rm_btn",
               "class": "leave_rm_btn"
            });
            leaveRoomBtn.appendChild(document.createTextNode("leave"));
            var newChat = document.createElement("div");
            setAttributes(newChat, {
               "id": id+"_chatlog",
               "class": "scroll"
            });
            newChatDiv.appendChild(newChatInput);
            newChatDiv.appendChild(newChatButton);
            newChatDiv.appendChild(leaveRoomBtn);
            newChatDiv.appendChild(newChat);
            document.getElementById(id+"_send_btn").addEventListener("click", function(){sendMessage(id);}, false);
            document.getElementById(id+"_leave_rm_btn").addEventListener("click", function(){

               // document.getElementById(id+"_span").parentElement.style.display="none";
               // document.getElementById(id).style.visibility="hidden";
               socketio.emit("user_leave_to_server", {user:userAlias, roomId:id});
               // openChat(0);

            }, false);
            showRoomUsers(id);
            if(rooms[id].owner == userAlias){
               showBannedUsers(id);
            } else {
               $("#banUserlist").empty();
               $("#banUserlist").hide();

            }
         } else {
            alert("password incorrect");
            promptPassword = prompt("Enter password");

         }
      } 
      else {
         // createChatroomBlock(id, newRoomName, false);

         var newChatInput = document.createElement("input");
         setAttributes(newChatInput, {
            "type": "text",
            "id": id+"_message_input"
         });
         var newChatButton = document.createElement("button");
         setAttributes(newChatButton, {
            "id": id+"_send_btn"
         });
         newChatButton.appendChild(document.createTextNode("send"));

         var leaveRoomBtn = document.createElement("button");
         setAttributes(leaveRoomBtn, {
            "id": id+"_leave_rm_btn",
            "class": "leave_rm_btn"
         });
         leaveRoomBtn.appendChild(document.createTextNode("leave"));

         var newChat = document.createElement("div");
         setAttributes(newChat, {
            "id": id+"_chatlog",
            "class": "scroll"
         });
         newChatDiv.appendChild(newChatInput);
         newChatDiv.appendChild(newChatButton);
         newChatDiv.appendChild(leaveRoomBtn);

         newChatDiv.appendChild(newChat);
         document.getElementById(id+"_send_btn").addEventListener("click", function(){sendMessage(id);}, false);
         document.getElementById(id+"_leave_rm_btn").addEventListener("click", function(){
            // document.getElementById(id+"_span").parentElement.style.display="none";
            // document.getElementById(id).style.visibility="hidden";
            socketio.emit("user_leave_to_server", {user:userAlias, roomId:id});
            // openChat(0);

         }, false);
         showRoomUsers(id);
         $("#banUserlist").empty();
         $("#banUserlist").hide();

      }
   }

   function showRoomUsers(id){
      document.getElementById("chatusers").style.visibility = "initial";
      if (id == currentRoomId){
         // console.log("|||||showing users list|||||");
         $("#userlist").empty();
         var currentUserList = rooms[id].users;
         // var isOwner = (rooms[id].owner == userAlias);
         for (var i = 0; i < currentUserList.length; i++){
            if(currentUserList[i]!="anonymous" && currentUserList[i]!=""){
               var userBtn = document.createElement("button");
               $(userBtn).attr({class: "list-group-item user-list", value: currentUserList[i]});
               userBtn.appendChild(document.createTextNode(currentUserList[i]));
               // console.log("outside isOwner, user is "+currentUserList[i] + ", owner is " + rooms[id].owner);
               document.getElementById("userlist").appendChild(userBtn);
               
               if (userAlias !== currentUserList[i]) {
                  console.log("user is "+currentUserList[i]+ ", owner is " + rooms[id].owner + ", self is " + userAlias);
                  var kicked = currentUserList[i];


                  userBtn.addEventListener("click", function(){
                     // console.log("preparing kick: " + id + "-----"+kicked);
                     console.log("kick: " + kicked + ", self: " + userAlias);

                        showOwnerOptions(id, kicked);
                        $("#owner-ops").dialog();
                     
                  }, false);
               }

            }
         }
      }
   }

   function showBannedUsers(id){
      if (userAlias == rooms[id].owner){
      console.log("showing banned users");
         document.getElementById("chatbans").style.visibility = "initial";
         $("#chatbans").show();
         if (id == currentRoomId){
            $("#banUserList").empty();
            var currentBanList = rooms[id].banlist;
            for (var i = 0; i < currentBanList.length; i++){
               if(currentBanList[i]!="anonymous"){
                  var userBtn = document.createElement("button");
                  $(userBtn).attr({class: "list-group-item ban-user-list", value: currentBanList[i]});
                  userBtn.appendChild(document.createTextNode(currentBanList[i]));
                  // console.log("outside isOwner, user is "+currentBanList[i] + ", owner is " + rooms[id].owner);
                  // document.getElementById("banUserlist").appendChild(userBtn);
                  $("#banUserList").append(userBtn);

                  // potential creative
                  if (rooms[id].owner == userAlias && userAlias != currentBanList[i]) {
                     var unban = currentBanList[i];

                     userBtn.addEventListener("click", function(){
                        console.log("    preparing kick: " + id + "-----"+unban);
                        // unban the user
                        socketio.emit("unban_user_to_server", {
                           user:unban,
                           owner:userAlias,
                           roomId:id
                        });
                     }, false);
                  }

               }
            }
         }
      } else {
         console.log("user is not owner");
      } 
   }

   function showOwnerOptions(id, user){
      console.log("should show options");
      var ownerOptionsDiv = document.createElement("div");
      setAttributes(ownerOptionsDiv, {
         "id": "owner-ops",
         "title": "Options"
      });
      ownerOptionsDiv.style.display="none";
      if(userAlias !== user){
         // private message this user
         var pmBtn = document.createElement("button");
         $(pmBtn).attr({class:"pm-btn", id:userAlias+"-"+user+"-pm-btn"});
         pmBtn.appendChild(document.createTextNode("Message"));
         pmBtn.addEventListener("click", function(){
            // ~~~~~~~shuya~~~~~~~
            socketio.emit("chat_private_server", { message_sender:userAlias, user:user});
         }, false);

         ownerOptionsDiv.appendChild(pmBtn);

         // add kick & ban buttons if owner
         if (rooms[id].owner == userAlias) {

            // kick user 
            var kickBtn = document.createElement("button");
            $(kickBtn).attr({class: "kick-btn", id:userAlias+"-"+user+"-kick-btn"});
            kickBtn.appendChild(document.createTextNode("kick"));
            kickBtn.addEventListener("click", function(){
               console.log("kicking user: " + user + " from room "+ id);
               $("#owner-ops").dialog("close");
               socketio.emit("kick_to_server", {roomId:id, kicker:userAlias, user:user});
            }, false);

            // ban user
            var banBtn = document.createElement("button");
            $(banBtn).attr({class: "ban-btn", id:userAlias+"-"+user+"-ban-btn"});
            banBtn.appendChild(document.createTextNode("ban"));
            banBtn.addEventListener("click", function(){
               $("#owner-ops").dialog("close");
               socketio.emit("ban_to_server", {roomId:id, kicker:userAlias, user:user});
            }, false);

            ownerOptionsDiv.appendChild(kickBtn);
            ownerOptionsDiv.appendChild(banBtn);
         }

         document.getElementById("chatinfo").appendChild(ownerOptionsDiv);
      }
   }

   // document.getElementById("0_room_btn").click();
   // document.getElementById("main_send_btn").addEventListener("click", function(){sendMessage("main");}, false);
   document.getElementsByName("choosePrivate")[0].addEventListener("change", function(){
      if(document.getElementById("radio-private").checked){
         document.getElementById("createPrivatePassword").style.visibility = "initial";
      } else {
         document.getElementById("createPrivatePassword").style.visibility = "hidden";
      }
   }, false);

   document.getElementById("createChatSubmit").addEventListener("click", function(){
      createChatroom();
      closeCreateChatDialog();
   }, false);

   document.addEventListener("DOMContentLoaded", socketListeners, false);


   </script>
</body>
</html>